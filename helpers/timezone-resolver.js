// timezone-resolver.js
// Utility for timezone lookups and metadata

// Timezone to country and code mapping
const TZ_COUNTRY_MAP = {
  "America/New_York": { country: "United States", code: "EST/EDT" },
  "America/Detroit": { country: "United States", code: "EST/EDT" },
  "America/Toronto": { country: "Canada", code: "EST/EDT" },
  "America/Chicago": { country: "United States", code: "CST/CDT" },
  "America/Winnipeg": { country: "Canada", code: "CST/CDT" },
  "America/Denver": { country: "United States", code: "MST/MDT" },
  "America/Phoenix": { country: "United States", code: "MST" },
  "America/Los_Angeles": { country: "United States", code: "PST/PDT" },
  "America/Vancouver": { country: "Canada", code: "PST/PDT" },
  "America/Anchorage": { country: "United States", code: "AKST/AKDT" },
  "America/Adak": { country: "United States", code: "HST/HDT" },
  "America/Juneau": { country: "United States", code: "AKST/AKDT" },
  "America/Regina": { country: "Canada", code: "CST" },
  "America/Edmonton": { country: "Canada", code: "MST/MDT" },
  "America/Halifax": { country: "Canada", code: "AST/ADT" },
  "America/Argentina/*": { country: "Argentina", code: "ART" },
  "America/Mexico_City": { country: "Mexico", code: "CST/CDT" },
  "America/Santiago": { country: "Chile", code: "CLT/CLST" },
  "America/Montevideo": { country: "Uruguay", code: "UYT" },
  "America/Bogota": { country: "Colombia", code: "COT" },
  "America/Lima": { country: "Peru", code: "PET" },
  "America/Caracas": { country: "Venezuela", code: "VET" },
  "America/Sao_Paulo": { country: "Brazil", code: "BRT/BRST" },
  "America/Asuncion": { country: "Paraguay", code: "PYT/PYST" },
  "America/La_Paz": { country: "Bolivia", code: "BOT" },
  "America/Guatemala": { country: "Guatemala", code: "CST" },
  "America/El_Salvador": { country: "El Salvador", code: "CST" },
  "America/Tegucigalpa": { country: "Honduras", code: "CST" },
  "America/Managua": { country: "Nicaragua", code: "CST" },
  "America/Panama": { country: "Panama", code: "EST" },
  "America/Port-au-Prince": { country: "Haiti", code: "EST" },
  "America/Santo_Domingo": { country: "Dominican Republic", code: "AST" },
  "America/Grand_Turk": { country: "Turks and Caicos Islands", code: "EST/EDT" },
  "America/Havana": { country: "Cuba", code: "CST/CDT" },
  "America/Puerto_Rico": { country: "Puerto Rico", code: "AST" },
  "America/Barbados": { country: "Barbados", code: "AST" },
  "America/Nassau": { country: "Bahamas", code: "EST/EDT" },
  "America/Jamaica": { country: "Jamaica", code: "EST" },
  "America/Curacao": { country: "Curaçao", code: "AST" },
  "America/Aruba": { country: "Aruba", code: "AST" },
  "America/Anguilla": { country: "Anguilla", code: "AST" },
  "America/Antigua": { country: "Antigua and Barbuda", code: "AST" },
  "America/Araguaina": { country: "Brazil", code: "BRT" },
  "America/Bahia": { country: "Brazil", code: "BRT" },
  "America/Bahia_Banderas": { country: "Mexico", code: "CST/CDT" },
  "America/Belem": { country: "Brazil", code: "BRT" },
  "America/Belize": { country: "Belize", code: "CST" },
  "America/Blanc-Sablon": { country: "Canada (Quebec – Blanc-Sablon)", code: "AST" },
  "America/Boa_Vista": { country: "Brazil", code: "AMT" },
  "America/Boise": { country: "United States", code: "MST/MDT" },
  "America/Buenos_Aires": { country: "Argentina", code: "ART" },
  "America/Cambridge_Bay": { country: "Canada", code: "MST/MDT" },
  "America/Campo_Grande": { country: "Brazil", code: "AMT" },
  "America/Cancun": { country: "Mexico", code: "EST" },
  "America/Catamarca": { country: "Argentina", code: "ART" },
  "America/Cayenne": { country: "French Guiana", code: "GFT" },
  "America/Cayman": { country: "Cayman Islands", code: "EST" },
  "America/Chihuahua": { country: "Mexico", code: "MST/MDT" },
  "America/Ciudad_Juarez": { country: "Mexico", code: "MST/MDT" },
  "America/Coral_Harbour": { country: "Canada (Atikokan, Ontario)", code: "EST" },
  "America/Cordoba": { country: "Argentina", code: "ART" },
  "America/Costa_Rica": { country: "Costa Rica", code: "CST" },
  "America/Coyhaique": { country: "Chile", code: "CLT/CLST" },
  "America/Creston": { country: "Canada (British Columbia)", code: "MST" },
  "America/Cuiaba": { country: "Brazil", code: "AMT" },
  "America/Danmarkshavn": { country: "Greenland", code: "GMT" },
  "America/Dawson": { country: "Canada (Yukon)", code: "MST/PDT" },
  "America/Dawson_Creek": { country: "Canada (British Columbia)", code: "MST" },
  "America/Dominica": { country: "Dominica", code: "AST" },
  "America/Eirunepe": { country: "Brazil", code: "ACT" },
  "America/Fort_Nelson": { country: "Canada (British Columbia)", code: "MST" },
  "America/Fortaleza": { country: "Brazil", code: "BRT" },
  "America/Glace_Bay": { country: "Canada (Nova Scotia)", code: "AST/ADT" },
  "America/Godthab": { country: "Greenland", code: "WGT/WGST" },
  "America/Goose_Bay": { country: "Canada (Labrador)", code: "AST/ADT" },
  "America/Grenada": { country: "Grenada", code: "AST" },
  "America/Guadeloupe": { country: "Guadeloupe", code: "AST" },
  "America/Guayaquil": { country: "Ecuador", code: "ECT" },
  "America/Guyana": { country: "Guyana", code: "GYT" },
  "America/Hermosillo": { country: "Mexico", code: "MST" },
  "America/Indiana/Knox": { country: "United States", code: "CST/CDT" },
  "America/Indiana/Marengo": { country: "United States", code: "EST/EDT" },
  "America/Indiana/Petersburg": { country: "United States", code: "EST/EDT" },
  "America/Indiana/Tell_City": { country: "United States", code: "CST/CDT" },
  "America/Indiana/Vevay": { country: "United States", code: "EST/EDT" },
  "America/Indiana/Vincennes": { country: "United States", code: "EST/EDT" },
  "America/Indiana/Winamac": { country: "United States", code: "EST/EDT" },
  "America/Indianapolis": { country: "United States", code: "EST/EDT" },
  "America/Inuvik": { country: "Canada (Northwest Territories)", code: "MST/MDT" },
  "America/Iqaluit": { country: "Canada (Nunavut)", code: "EST/EDT" },
  "America/Jujuy": { country: "Argentina", code: "ART" },
  "America/Kentucky/Monticello": { country: "United States", code: "EST/EDT" },
  "America/Kralendijk": { country: "Caribbean Netherlands", code: "AST" },
  "America/Louisville": { country: "United States", code: "EST/EDT" },
  "America/Lower_Princes": { country: "Sint Maarten", code: "AST" },
  "America/Maceio": { country: "Brazil", code: "BRT" },
  "America/Manaus": { country: "Brazil", code: "AMT" },
  "America/Marigot": { country: "Saint Martin (French part)", code: "AST" },
  "America/Martinique": { country: "Martinique", code: "AST" },
  "America/Matamoros": { country: "Mexico", code: "CST/CDT" },
  "America/Mazatlan": { country: "Mexico", code: "MST/MDT" },
  "America/Mendoza": { country: "Argentina", code: "ART" },
  "America/Menominee": { country: "United States", code: "CST/CDT" },
  "America/Merida": { country: "Mexico", code: "CST/CDT" },
  "America/Metlakatla": { country: "United States (Alaska)", code: "AKST/AKDT" },
  "America/Miquelon": { country: "Saint Pierre and Miquelon", code: "PMST/PMDT" },
  "America/Moncton": { country: "Canada (New Brunswick)", code: "AST/ADT" },
  "America/Monterrey": { country: "Mexico", code: "CST/CDT" },
  "America/Montserrat": { country: "Montserrat", code: "AST" },
  "America/Nome": { country: "United States (Alaska)", code: "AKST/AKDT" },
  "America/Noronha": { country: "Brazil", code: "FNT" },
  "America/North_Dakota/Beulah": { country: "United States", code: "CST/CDT" },
  "America/North_Dakota/Center": { country: "United States", code: "CST/CDT" },
  "America/North_Dakota/New_Salem": { country: "United States", code: "CST/CDT" },
  "America/Ojinaga": { country: "Mexico", code: "MST/MDT" },
  "America/Paramaribo": { country: "Suriname", code: "SRT" },
  "America/Port_of_Spain": { country: "Trinidad and Tobago", code: "AST" },
  "America/Porto_Velho": { country: "Brazil", code: "AMT" },
  "America/Punta_Arenas": { country: "Chile", code: "CLT" },
  "America/Rankin_Inlet": { country: "Canada (Nunavut)", code: "CST/CDT" },
  "America/Recife": { country: "Brazil", code: "BRT" },
  "America/Resolute": { country: "Canada (Nunavut)", code: "CST/CDT" },
  "America/Rio_Branco": { country: "Brazil", code: "ACT" },
  "America/Santarem": { country: "Brazil", code: "BRT" },
  "America/Scoresbysund": { country: "Greenland", code: "EGT/EGST" },
  "America/Sitka": { country: "United States (Alaska)", code: "AKST/AKDT" },
  "America/St_Barthelemy": { country: "Saint Barthélemy", code: "AST" },
  "America/St_Johns": { country: "Canada (Newfoundland)", code: "NST/NDT" },
  "America/St_Kitts": { country: "Saint Kitts and Nevis", code: "AST" },
  "America/St_Lucia": { country: "Saint Lucia", code: "AST" },
  "America/St_Thomas": { country: "United States Virgin Islands", code: "AST" },
  "America/St_Vincent": { country: "Saint Vincent and the Grenadines", code: "AST" },
  "America/Swift_Current": { country: "Canada (Saskatchewan)", code: "CST" },
  "America/Thule": { country: "Greenland", code: "AST/ADT" },
  "America/Tijuana": { country: "Mexico", code: "PST/PDT" },
  "America/Tortola": { country: "British Virgin Islands", code: "AST" },
  "America/Whitehorse": { country: "Canada (Yukon)", code: "MST/PDT" },
  "America/Yakutat": { country: "United States (Alaska)", code: "AKST/AKDT" },
  "Antarctica/Casey": { country: "Antarctica (Casey Station – Australia)", code: "AWST" },
  "Antarctica/Davis": { country: "Antarctica (Davis Station – Australia)", code: "DAVT" },
  "Antarctica/DumontDUrville": { country: "Antarctica (Dumont d'Urville Station – France)", code: "DDUT" },
  "Antarctica/Macquarie": { country: "Australia (Macquarie Island)", code: "MIST" },
  "Antarctica/Mawson": { country: "Antarctica (Mawson Station – Australia)", code: "MAWT" },
  "Antarctica/McMurdo": { country: "Antarctica (McMurdo Station – New Zealand)", code: "NZST/NZDT" },
  "Antarctica/Palmer": { country: "Antarctica (Palmer Station – Chile)", code: "CLT/CLST" },
  "Antarctica/Rothera": { country: "Antarctica (Rothera Station – UK)", code: "ROTT" },
  "Antarctica/Syowa": { country: "Antarctica (Syowa Station – Japan)", code: "SYOT" },
  "Antarctica/Troll": { country: "Antarctica (Troll Station – Norway)", code: "UTC/CEST" },
  "Antarctica/Vostok": { country: "Antarctica (Vostok Station – Russia)", code: "VOST" },
  "Arctic/Longyearbyen": { country: "Svalbard (Norway)", code: "CET/CEST" },
  "Europe/London": { country: "United Kingdom", code: "GMT/BST" },
  "Europe/Dublin": { country: "Ireland", code: "GMT/IST" },
  "Europe/Paris": { country: "France", code: "CET/CEST" },
  "Europe/Berlin": { country: "Germany", code: "CET/CEST" },
  "Europe/Madrid": { country: "Spain", code: "CET/CEST" },
  "Europe/Rome": { country: "Italy", code: "CET/CEST" },
  "Europe/Amsterdam": { country: "Netherlands", code: "CET/CEST" },
  "Europe/Brussels": { country: "Belgium", code: "CET/CEST" },
  "Europe/Vienna": { country: "Austria", code: "CET/CEST" },
  "Europe/Zurich": { country: "Switzerland", code: "CET/CEST" },
  "Europe/Prague": { country: "Czechia", code: "CET/CEST" },
  "Europe/Warsaw": { country: "Poland", code: "CET/CEST" },
  "Europe/Stockholm": { country: "Sweden", code: "CET/CEST" },
  "Europe/Oslo": { country: "Norway", code: "CET/CEST" },
  "Europe/Copenhagen": { country: "Denmark", code: "CET/CEST" },
  "Europe/Helsinki": { country: "Finland", code: "EET/EEST" },
  "Europe/Athens": { country: "Greece", code: "EET/EEST" },
  "Europe/Bucharest": { country: "Romania", code: "EET/EEST" },
  "Europe/Sofia": { country: "Bulgaria", code: "EET/EEST" },
  "Europe/Lisbon": { country: "Portugal", code: "WET/WEST" },
  "Europe/Istanbul": { country: "Türkiye", code: "TRT" },
  "Europe/Moscow": { country: "Russia", code: "MSK" },
  "Europe/Kiev": { country: "Ukraine", code: "EET/EEST" },
  "Europe/Chisinau": { country: "Moldova", code: "EET/EEST" },
  "Europe/Belgrade": { country: "Serbia", code: "CET/CEST" },
  "Europe/Sarajevo": { country: "Bosnia and Herzegovina", code: "CET/CEST" },
  "Europe/Skopje": { country: "North Macedonia", code: "CET/CEST" },
  "Europe/Tirane": { country: "Albania", code: "CET/CEST" },
  "Europe/Vilnius": { country: "Lithuania", code: "EET/EEST" },
  "Europe/Riga": { country: "Latvia", code: "EET/EEST" },
  "Europe/Tallinn": { country: "Estonia", code: "EET/EEST" },
  "Europe/Andorra": { country: "Andorra", code: "CET/CEST" },
  "Europe/Monaco": { country: "Monaco", code: "CET/CEST" },
  "Europe/San_Marino": { country: "San Marino", code: "CET/CEST" },
  "Europe/Vatican": { country: "Vatican City", code: "CET/CEST" },
  "Europe/Luxembourg": { country: "Luxembourg", code: "CET/CEST" },
  "Europe/Valletta": { country: "Malta", code: "CET/CEST" },
  "Europe/Gibraltar": { country: "Gibraltar", code: "CET/CEST" },
  "Europe/Podgorica": { country: "Montenegro", code: "CET/CEST" },
  "Europe/Bratislava": { country: "Slovakia", code: "CET/CEST" },
  "Europe/Zagreb": { country: "Croatia", code: "CET/CEST" },
  "Europe/Slovenia": { country: "Slovenia", code: "CET/CEST" },
  "Europe/Astrakhan": { country: "Russia (Astrakhan)", code: "MSK+1" },
  "Europe/Budapest": { country: "Hungary", code: "CET/CEST" },
  "Europe/Busingen": { country: "Germany (Busingen)", code: "CET/CEST" },
  "Europe/Guernsey": { country: "Guernsey", code: "GMT/BST" },
  "Europe/Isle_of_Man": { country: "Isle of Man", code: "GMT/BST" },
  "Europe/Jersey": { country: "Jersey", code: "GMT/BST" },
  "Europe/Kaliningrad": { country: "Russia (Kaliningrad)", code: "EET" },
  "Europe/Kirov": { country: "Russia (Kirov)", code: "MSK+0" },
  "Europe/Ljubljana": { country: "Slovenia", code: "CET/CEST" },
  "Europe/Malta": { country: "Malta", code: "CET/CEST" },
  "Europe/Mariehamn": { country: "Åland Islands", code: "EET/EEST" },
  "Europe/Minsk": { country: "Belarus", code: "MSK" },
  "Europe/Samara": { country: "Russia (Samara)", code: "SAMT" },
  "Europe/Saratov": { country: "Russia (Saratov)", code: "MSK+1" },
  "Europe/Simferopol": { country: "Crimea", code: "MSK" },
  "Europe/Ulyanovsk": { country: "Russia (Ulyanovsk)", code: "MSK+1" },
  "Europe/Vaduz": { country: "Liechtenstein", code: "CET/CEST" },
  "Europe/Volgograd": { country: "Russia (Volgograd)", code: "MSK+1" },
  "Indian/Antananarivo": { country: "Madagascar", code: "EAT" },
  "Indian/Chagos": { country: "British Indian Ocean Territory", code: "IOT" },
  "Indian/Christmas": { country: "Christmas Island", code: "CXT" },
  "Indian/Cocos": { country: "Cocos (Keeling) Islands", code: "CCT" },
  "Indian/Comoro": { country: "Comoros", code: "EAT" },
  "Indian/Kerguelen": { country: "French Southern and Antarctic Lands", code: "TFT" },
  "Indian/Mahe": { country: "Seychelles", code: "SCT" },
  "Indian/Maldives": { country: "Maldives", code: "MVT" },
  "Indian/Mauritius": { country: "Mauritius", code: "MUT" },
  "Indian/Mayotte": { country: "Mayotte", code: "EAT" },
  "Indian/Reunion": { country: "Réunion", code: "RET" },
  "Africa/Cairo": { country: "Egypt", code: "EET" },
  "Africa/Casablanca": { country: "Morocco", code: "WET/WEST" },
  "Africa/Algiers": { country: "Algeria", code: "CET" },
  "Africa/Tunis": { country: "Tunisia", code: "CET" },
  "Africa/Tripoli": { country: "Libya", code: "EET" },
  "Africa/Nairobi": { country: "Kenya", code: "EAT" },
  "Africa/Johannesburg": { country: "South Africa", code: "SAST" },
  "Africa/Lagos": { country: "Nigeria", code: "WAT" },
  "Africa/Accra": { country: "Ghana", code: "GMT" },
  "Africa/Addis_Ababa": { country: "Ethiopia", code: "EAT" },
  "Africa/Khartoum": { country: "Sudan", code: "CAT" },
  "Africa/Harare": { country: "Zimbabwe", code: "CAT" },
  "Africa/Maputo": { country: "Mozambique", code: "CAT" },
  "Africa/Windhoek": { country: "Namibia", code: "WAT/WAST" },
  "Africa/Dakar": { country: "Senegal", code: "GMT" },
  "Africa/Abidjan": { country: "Côte d'Ivoire", code: "GMT" },
  "Africa/Luanda": { country: "Angola", code: "WAT" },
  "Africa/Kinshasa": { country: "DR Congo", code: "WAT" },
  "Africa/Lubumbashi": { country: "DR Congo", code: "CAT" },
  "Africa/Dar_es_Salaam": { country: "Tanzania", code: "EAT" },
  "Africa/Kampala": { country: "Uganda", code: "EAT" },
  "Africa/Djibouti": { country: "Djibouti", code: "EAT" },
  "Africa/Mogadishu": { country: "Somalia", code: "EAT" },
  "Africa/Libreville": { country: "Gabon", code: "WAT" },
  "Africa/Conakry": { country: "Guinea", code: "GMT" },
  "Africa/Bamako": { country: "Mali", code: "GMT" },
  "Africa/Ouagadougou": { country: "Burkina Faso", code: "GMT" },
  "Africa/Niamey": { country: "Niger", code: "WAT" },
  "Africa/Nouakchott": { country: "Mauritania", code: "GMT" },
  "Africa/Porto-Novo": { country: "Benin", code: "WAT" },
  "Africa/Lome": { country: "Togo", code: "GMT" },
  "Africa/Freetown": { country: "Sierra Leone", code: "GMT" },
  "Africa/Banjul": { country: "Gambia", code: "GMT" },
  "Africa/Bissau": { country: "Guinea-Bissau", code: "GMT" },
  "Africa/Sao_Tome": { country: "São Tomé and Príncipe", code: "GMT" },
  "Africa/El_Aaiun": { country: "Western Sahara", code: "WET/WEST" },
  "Africa/Maseru": { country: "Lesotho", code: "SAST" },
  "Africa/Mbabane": { country: "Eswatini", code: "SAST" },
  "Africa/Gaborone": { country: "Botswana", code: "CAT" },
  "Africa/Blantyre": { country: "Malawi", code: "CAT" },
  "Africa/Brazzaville": { country: "Republic of the Congo", code: "WAT" },
  "Africa/Bujumbura": { country: "Burundi", code: "CAT" },
  "Africa/Asmera": { country: "Eritrea", code: "EAT" },
  "Africa/Bangui": { country: "Central African Republic", code: "WAT" },
  "Africa/Ceuta": { country: "Spain (Ceuta)", code: "CET/CEST" },
  "Africa/Douala": { country: "Cameroon", code: "WAT" },
  "Africa/Juba": { country: "South Sudan", code: "CAT" },
  "Africa/Kigali": { country: "Rwanda", code: "CAT" },
  "Africa/Lusaka": { country: "Zambia", code: "CAT" },
  "Africa/Malabo": { country: "Equatorial Guinea", code: "WAT" },
  "Africa/Monrovia": { country: "Liberia", code: "GMT" },
  "Africa/Ndjamena": { country: "Chad", code: "WAT" },
  "Asia/Kolkata": { country: "India", code: "IST" },
  "Asia/Calcutta": { country: "India", code: "IST" },
  "Asia/Katmandu": { country: "Nepal", code: "NPT" },
  "Asia/Dhaka": { country: "Bangladesh", code: "BDT" },
  "Asia/Colombo": { country: "Sri Lanka", code: "SLST" },
  "Asia/Karachi": { country: "Pakistan", code: "PKT" },
  "Asia/Kabul": { country: "Afghanistan", code: "AFT" },
  "Asia/Dubai": { country: "United Arab Emirates", code: "GST" },
  "Asia/Muscat": { country: "Oman", code: "GST" },
  "Asia/Qatar": { country: "Qatar", code: "AST" },
  "Asia/Riyadh": { country: "Saudi Arabia", code: "AST" },
  "Asia/Jerusalem": { country: "Israel", code: "IST/IDT" },
  "Asia/Amman": { country: "Jordan", code: "EET/EEST" },
  "Asia/Beirut": { country: "Lebanon", code: "EET/EEST" },
  "Asia/Tehran": { country: "Iran", code: "IRST/IRDT" },
  "Asia/Baghdad": { country: "Iraq", code: "AST" },
  "Asia/Kuwait": { country: "Kuwait", code: "AST" },
  "Asia/Bahrain": { country: "Bahrain", code: "AST" },
  "Asia/Doha": { country: "Qatar", code: "AST" },
  "Asia/Hong_Kong": { country: "Hong Kong", code: "HKT" },
  "Asia/Shanghai": { country: "China", code: "CST" },
  "Asia/Taipei": { country: "Taiwan", code: "CST" },
  "Asia/Seoul": { country: "South Korea", code: "KST" },
  "Asia/Tokyo": { country: "Japan", code: "JST" },
  "Asia/Singapore": { country: "Singapore", code: "SGT" },
  "Asia/Manila": { country: "Philippines", code: "PHT" },
  "Asia/Ho_Chi_Minh": { country: "Vietnam", code: "ICT" },
  "Asia/Bangkok": { country: "Thailand", code: "ICT" },
  "Asia/Jakarta": { country: "Indonesia", code: "WIB" },
  "Asia/Kuala_Lumpur": { country: "Malaysia", code: "MYT" },
  "Asia/Macau": { country: "Macau", code: "CST" },
  "Asia/Phnom_Penh": { country: "Cambodia", code: "ICT" },
  "Asia/Vientiane": { country: "Laos", code: "ICT" },
  "Asia/Hebron": { country: "Palestine", code: "EET/EEST" },
  "Asia/Gaza": { country: "Palestine", code: "EET/EEST" },
  "Asia/Aden": { country: "Yemen", code: "AST" },
  "Asia/Almaty": { country: "Kazakhstan", code: "ALMT" },
  "Asia/Anadyr": { country: "Russia", code: "ANAT/ANAST" },
  "Asia/Aqtau": { country: "Kazakhstan", code: "AQTT" },
  "Asia/Aqtobe": { country: "Kazakhstan", code: "AQTT" },
  "Asia/Ashgabat": { country: "Turkmenistan", code: "TMT" },
  "Asia/Atyrau": { country: "Kazakhstan", code: "AQTT" },
  "Asia/Baku": { country: "Azerbaijan", code: "AZT/AZST" },
  "Asia/Barnaul": { country: "Russia", code: "KRAT" },
  "Asia/Bishkek": { country: "Kyrgyzstan", code: "KGT" },
  "Asia/Brunei": { country: "Brunei", code: "BNT" },
  "Asia/Chita": { country: "Russia", code: "YAKT" },
  "Asia/Damascus": { country: "Syria", code: "EET/EEST" },
  "Asia/Dili": { country: "East Timor", code: "TLT" },
  "Asia/Dushanbe": { country: "Tajikistan", code: "TJT" },
  "Asia/Famagusta": { country: "Cyprus", code: "EET/EEST" },
  "Asia/Hovd": { country: "Mongolia", code: "HOVT" },
  "Asia/Irkutsk": { country: "Russia", code: "IRKT" },
  "Asia/Jayapura": { country: "Indonesia", code: "WIT" },
  "Asia/Kamchatka": { country: "Russia", code: "PETT/PETST" },
  "Asia/Khandyga": { country: "Russia", code: "YAKT" },
  "Asia/Krasnoyarsk": { country: "Russia", code: "KRAT" },
  "Asia/Kuching": { country: "Malaysia", code: "MYT" },
  "Asia/Magadan": { country: "Russia", code: "MAGT" },
  "Asia/Makassar": { country: "Indonesia", code: "WITA" },
  "Asia/Nicosia": { country: "Cyprus", code: "EET/EEST" },
  "Asia/Novokuznetsk": { country: "Russia", code: "KRAT" },
  "Asia/Novosibirsk": { country: "Russia", code: "NOVT" },
  "Asia/Omsk": { country: "Russia", code: "OMST" },
  "Asia/Oral": { country: "Kazakhstan", code: "ORAT" },
  "Asia/Pontianak": { country: "Indonesia", code: "WIB" },
  "Asia/Pyongyang": { country: "North Korea", code: "KST" },
  "Asia/Qostanay": { country: "Kazakhstan", code: "QOST" },
  "Asia/Qyzylorda": { country: "Kazakhstan", code: "QYZT" },
  "Asia/Rangoon": { country: "Myanmar", code: "MMT" },
  "Asia/Saigon": { country: "Vietnam", code: "ICT" },
  "Asia/Sakhalin": { country: "Russia", code: "SAKT" },
  "Asia/Samarkand": { country: "Uzbekistan", code: "UZT" },
  "Asia/Srednekolymsk": { country: "Russia", code: "SRET" },
  "Asia/Tashkent": { country: "Uzbekistan", code: "UZT" },
  "Asia/Tbilisi": { country: "Georgia", code: "GET" },
  "Asia/Thimphu": { country: "Bhutan", code: "BTT" },
  "Asia/Tomsk": { country: "Russia", code: "KRAT" },
  "Asia/Ulaanbaatar": { country: "Mongolia", code: "ULAT" },
  "Asia/Urumqi": { country: "China", code: "XJT" },
  "Asia/Ust-Nera": { country: "Russia", code: "VLAT" },
  "Asia/Vladivostok": { country: "Russia", code: "VLAT" },
  "Asia/Yakutsk": { country: "Russia", code: "YAKT" },
  "Asia/Yekaterinburg": { country: "Russia", code: "YEKT" },
  "Asia/Yerevan": { country: "Armenia", code: "AMT" },
  "Australia/Sydney": { country: "Australia", code: "AEST/AEDT" },
  "Australia/Melbourne": { country: "Australia", code: "AEST/AEDT" },
  "Australia/Brisbane": { country: "Australia", code: "AEST" },
  "Australia/Perth": { country: "Australia", code: "AWST" },
  "Australia/Adelaide": { country: "Australia", code: "ACST/ACDT" },
  "Australia/Darwin": { country: "Australia", code: "ACST" },
  "Australia/Hobart": { country: "Australia", code: "AEST/AEDT" },
  "Australia/Broken_Hill": { country: "Australia", code: "ACST/ACDT" },
  "Australia/Eucla": { country: "Australia", code: "ACWST" },
  "Australia/Lindeman": { country: "Australia", code: "AEST" },
  "Australia/Lord_Howe": { country: "Australia", code: "LHST/LHDT" },
  "Pacific/Bougainville": { country: "Papua New Guinea (Bougainville)", code: "BST" },
  "Pacific/Easter": { country: "Chile (Easter Island)", code: "EAST/EASST" },
  "Pacific/Efate": { country: "Vanuatu", code: "VUT" },
  "Pacific/Enderbury": { country: "Kiribati (Phoenix Islands)", code: "PHOT" },
  "Pacific/Fakaofo": { country: "Tokelau", code: "TKT" },
  "Pacific/Funafuti": { country: "Tuvalu", code: "TVT" },
  "Pacific/Galapagos": { country: "Ecuador (Galapagos)", code: "GALT" },
  "Pacific/Gambier": { country: "French Polynesia (Gambier Islands)", code: "GAMT" },
  "Pacific/Guadalcanal": { country: "Solomon Islands", code: "SBT" },
  "Pacific/Kosrae": { country: "Micronesia (Kosrae)", code: "KOST" },
  "Pacific/Kwajalein": { country: "Marshall Islands (Kwajalein)", code: "MHT" },
  "Pacific/Majuro": { country: "Marshall Islands (Majuro)", code: "MHT" },
  "Pacific/Marquesas": { country: "French Polynesia (Marquesas)", code: "MART" },
  "Pacific/Midway": { country: "United States (Midway, American Samoa)", code: "SST" },
  "Pacific/Nauru": { country: "Nauru", code: "NRT" },
  "Pacific/Niue": { country: "Niue", code: "NUT" },
  "Pacific/Norfolk": { country: "Norfolk Island", code: "NFT/NFDT" },
  "Pacific/Pago_Pago": { country: "American Samoa", code: "SST" },
  "Pacific/Palau": { country: "Palau", code: "PWT" },
  "Pacific/Pitcairn": { country: "Pitcairn Islands", code: "PST" },
  "Pacific/Ponape": { country: "Micronesia (Pohnpei)", code: "PONT" },
  "Pacific/Saipan": { country: "Northern Mariana Islands", code: "ChST" },
  "Pacific/Tarawa": { country: "Kiribati (Gilbert Islands)", code: "GILT" },
  "Pacific/Truk": { country: "Micronesia (Chuuk)", code: "CHUT" },
  "Pacific/Wake": { country: "United States (Wake Island)", code: "WAKT" },
  "Pacific/Wallis": { country: "Wallis and Futuna", code: "WFT" },
  "Pacific/Auckland": { country: "New Zealand", code: "NZST/NZDT" },
  "Pacific/Chatham": { country: "New Zealand", code: "CHAST/CHADT" },
  "Pacific/Fiji": { country: "Fiji", code: "FJT" },
  "Pacific/Guam": { country: "Guam", code: "ChST" },
  "Pacific/Honolulu": { country: "United States", code: "HST" },
  "Pacific/Tahiti": { country: "French Polynesia", code: "TAHT" },
  "Pacific/Samoa": { country: "American Samoa", code: "SST" },
  "Pacific/Apia": { country: "Samoa", code: "WST" },
  "Pacific/Port_Moresby": { country: "Papua New Guinea", code: "PGT" },
  "Pacific/Noumea": { country: "New Caledonia", code: "NCT" },
  "Pacific/Rarotonga": { country: "Cook Islands", code: "CKT" },
  "Pacific/Tongatapu": { country: "Tonga", code: "TOT" },
  "Pacific/Kiritimati": { country: "Kiribati", code: "LINT" },
  "Atlantic/Azores": { country: "Portugal (Azores)", code: "AZOT/AZOST" },
  "Atlantic/Bermuda": { country: "Bermuda", code: "AST/ADT" },
  "Atlantic/Canary": { country: "Spain (Canary Islands)", code: "WET/WEST" },
  "Atlantic/Cape_Verde": { country: "Cape Verde", code: "CVT" },
  "Atlantic/Faroe": { country: "Faroe Islands", code: "WET/WEST" },
  "Atlantic/Madeira": { country: "Portugal (Madeira)", code: "WET/WEST" },
  "Atlantic/Reykjavik": { country: "Iceland", code: "GMT" },
  "Atlantic/South_Georgia": { country: "South Georgia and the South Sandwich Islands", code: "GST" },
  "Atlantic/St_Helena": { country: "Saint Helena, Ascension and Tristan da Cunha", code: "GMT" },
  "Atlantic/Stanley": { country: "Falkland Islands", code: "FKT/FKST" },
  "Atlantic/Faeroe": { country: "Faroe Islands", code: "WET/WEST" }
};

export const TimezoneResolver = {
  buildTimezoneRows(timezones) {
    const rows = [];
    const now = new Date();

    timezones.forEach(tz => {
      try {
        const offset = this.getGMTOffset(now, tz);
        const offsetMinutes = this.getOffsetMinutes(offset);
        const country = this.getCountryFromTimezone(tz);
        const code = this.getTimezoneCode(tz);
      
        rows.push({
          timezone: tz,
          country: country,
          code: code,
          offset: offset,
          offsetMinutes: offsetMinutes,
        });
      } catch (err) {
        console.warn(`Skipping invalid timezone: ${tz}`, err);
      }
    });

    return rows;
  },

  getCountryFromTimezone(timezone) {
    // Check for exact matches first
    if (TZ_COUNTRY_MAP[timezone]) {
      return TZ_COUNTRY_MAP[timezone].country;
    }

    // Check for prefix matches (e.g., "America/Argentina/*")
    for (const [pattern, data] of Object.entries(TZ_COUNTRY_MAP)) {
      if (pattern.endsWith('/*') && timezone.startsWith(pattern.slice(0, -2))) {
        return data.country;
      }
    }
  },

  getTimezoneCode(timezone) {
    // Check for exact matches first
    if (TZ_COUNTRY_MAP[timezone]) {
      return TZ_COUNTRY_MAP[timezone].code;
    }

    // Check for prefix matches (e.g., "America/Argentina/*")
    for (const [pattern, data] of Object.entries(TZ_COUNTRY_MAP)) {
      if (pattern.endsWith('/*') && timezone.startsWith(pattern.slice(0, -2))) {
        return data.code;
      }
    }

    // Fallback: return null if no code found
    return null;
  },

  getOffsetMinutes(offset) {
    // Convert offset string to numeric value for sorting
    if (!offset || offset === 'UTC') return 0;

    // Handle formats like "GMT+5:30", "GMT+5", "GMT +5:30", etc.
    const gmtMatch = offset.match(/(?:GMT|UTC)\s*?([+-])(\d{1,2}):?(\d{2})?/);
    if (gmtMatch) {
      const sign = gmtMatch[1] === '+' ? 1 : -1;
      const hours = parseInt(gmtMatch[2]) || 0;
      const minutes = parseInt(gmtMatch[3]) || 0;
      return sign * (hours * 60 + minutes);
    }
  },

  getGMTOffset(date, tz) {
    try {
      const formatter = new Intl.DateTimeFormat('en-US', {
        timeZone: tz,
        hour12: false,
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
      });

      const parts = formatter.formatToParts(date);
      const getPart = (type) => parts.find(p => p.type === type).value;

      const year = parseInt(getPart('year'));
      const month = parseInt(getPart('month'));
      const day = parseInt(getPart('day'));
      const hour = parseInt(getPart('hour'));
      const minute = parseInt(getPart('minute'));
      const second = parseInt(getPart('second'));

      // Convert target time to UTC timestamp
      const utcDate = new Date(Date.UTC(year, month - 1, day, hour, minute, second));

      // Offset in minutes (rounded)
      const offsetMinutes = Math.round((utcDate.getTime() - date.getTime()) / (1000 * 60));

      const sign = offsetMinutes <= 0 ? '-' : '+';
      const absMinutes = Math.abs(offsetMinutes);
      const hours = String(Math.floor(absMinutes / 60)).padStart(2, '0');
      const minutes = String(absMinutes % 60).padStart(2, '0');

      return `GMT${sign}${hours}:${minutes}`;
    } catch (err) {
      console.error(`Error calculating GMT offset for timezone: ${tz}`, err);
      return 'GMT';
    }
  }
};